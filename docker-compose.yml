services:
  mongodb:
    image: mongo:latest
    container_name: turing_mongodb
    ports:
      - "${MONGO_HOST_PORT:-27017}:27017"

    volumes:
      - mongodb_data:/data/db
    networks:
      - turing_network

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: turing_backend
    ports:
      - "${BACKEND_PORT:-8000}:8000"
    env_file:
      - .env
    environment:
      - PORT=8000
      - MONGODB_URI=mongodb://mongodb:27017/turing_pg
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
      - ACCESS_TOKEN_SECRET=${ACCESS_TOKEN_SECRET:-your_access_token_secret_here}
      - ACCESS_TOKEN_EXPIRY=${ACCESS_TOKEN_EXPIRY:-1d}
      - REFRESH_TOKEN_SECRET=${REFRESH_TOKEN_SECRET:-your_refresh_token_secret_here}
      - REFRESH_TOKEN_EXPIRY=${REFRESH_TOKEN_EXPIRY:-10d}
    depends_on:
      - mongodb
    networks:
      - turing_network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: turing_frontend
    ports:
      - "${FRONTEND_PORT:-3001}:80"
    env_file:
      - .env
    depends_on:
      - backend
    networks:
      - turing_network

  ml:
    build:
      context: ./ML
      dockerfile: Dockerfile
    container_name: turing_ml
    volumes:
      - ./ML:/app
    networks:
      - turing_network

networks:
  turing_network:
    driver: bridge

volumes:
  mongodb_data:
